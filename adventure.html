// ===== Versuch, eine Station zu √∂ffnen ‚Äì erst Entfernung und dann Item-Voraussetzungen pr√ºfen =====
function attemptOpenStation(st) {
  // 1. Pr√ºfen, ob alle ben√∂tigten Items vorhanden sind
  const missing = (st.requiresItems || []).filter(req => !inventory.includes(req));
  if (missing.length > 0) {
    contentDiv.innerHTML = `<p>üîí Du ben√∂tigst zuerst folgendes Item, um "${st.id}" freizuschalten: <b>${missing.join(", ")}</b></p>`;
    return;
  }

  // 2. Wenn Items ok, dann Geolocation abfragen
  if (!navigator.geolocation) {
    contentDiv.innerHTML = `<p>‚ö†Ô∏è Geolocation nicht unterst√ºtzt.</p>`;
    return;
  }

  navigator.geolocation.getCurrentPosition(pos => {
    const d = distanceInMeters(pos.coords.latitude, pos.coords.longitude, st.lat, st.lng);
    if (d <= NEARBY_THRESHOLD) {
      openStation(st.id);
    } else {
      contentDiv.innerHTML = `<p>Du bist ${Math.round(d)} m entfernt. Geh n√§her an Station "${st.id}" heran!</p>`;
    }
  }, _err => {
    contentDiv.innerHTML = `<p>‚ö†Ô∏è Position konnte nicht ermittelt werden.</p>`;
  });
}

// ===== Marker-Klick: Entfernung & Item-Check =====
function onMarkerClick(st) {
  attemptOpenStation(st);
}
