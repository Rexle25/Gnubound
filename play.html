<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Wandercode Play</title>
</head>
<body>
    <h1 id="titel">Füge deinen JSON-Text der Schnitzeljagd ein:</h1>

    <!-- Komma entfernt -->
    <input type="text" id="textInput">

    <button onclick="parseJSON()">JSON anwenden und Schnitzeljagd (neu)starten</button>
    <button onclick="Laden()">Schnitzeljagd weiterspielen</button>

    <script>
        // 'data' muss veränderbar sein → let statt const
        let data = null;
        let index = 0;

        function parseJSON() {
            const input = document.getElementById('textInput').value;
            data = JSON.parse(input);
            index = 0;           // beim Neustart immer von vorne
            document.getElementById('titel').innerText = data.title || '';
            Start();
        }

        function Start() {
            Abschnitt();
        }

        function Speichern() {
            // Schlüssel als Strings, und JSON.stringify
            localStorage.setItem("json", JSON.stringify(data));
            localStorage.setItem("id", index.toString());
        }

        function Laden() {
            const savedJson = localStorage.getItem("json");
            const savedId   = localStorage.getItem("id");
            if (savedJson && savedId !== null) {
                data  = JSON.parse(savedJson);
                index = parseInt(savedId, 10);
                document.getElementById('titel').innerText = data.title || '';
                Start();
            } else {
                alert("Kein gespeicherter Spielstand gefunden.");
            }
        }

        function Abschnitt() {
            // Stelle sicher, dass data geladen ist
            if (!data || !data.stations || !data.stations[index]) return;

            const station = data.stations[index];
            const type    = station.type;

            switch (type) {
                case "info":
                    info(station);
                    break;
                case "question":
                    question(station);
                    break;
                case "gps":
                    gps(station);
                    break;
                default:
                    console.warn("Unbekannter Typ:", type);
            }
        }

        // Alle Funktionen bekommen jetzt 'station' übergeben
        function info(station) {
            const text = document.createElement("p");
            text.innerText = station.text;
            document.body.appendChild(text);
            const nextButton = document.createElement("button");
            nextButton.innerHTML = "Weiter";
            document.body.appendChild(nextButton);
            nextButton.onclick = weiter;
        }

        function question(station) {
            const text = document.createElement("p");
            text.innerText = station.text;
            document.body.appendChild(text);
            let input = document.createElement("input");
            input.type = "text";
            
        }

        function gps(station) {
            const text = document.createElement("p");
            text.innerText = station.text;
            document.body.appendChild(text);
        }

        function weiter() {
            text.remove();
            index++;
            Speichern();
            Abschnitt();

        }

    
    </script>
</body>
</html> 