<!DOCTYPE html>
<head>
    <title>Gurkenjagd</title>
     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

      <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

     <link rel="stylesheet" href="style.css">
</head>

<body>

    <script src="achievments.js"></script> 
    <script src="getRegionData.js"></script> 

     <div id="map"></div>

     <script>
     
     var map = L.map('map').setView([47.505, 7.09], 13);
     L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);



     </script>

     <script>
        

        setInterval(() => {
            achievments();


        }, 10000);


     </script>
    
    <script>

        function tagsEnthält(tags, suchwort) {
            const suchwortKlein = suchwort.toLowerCase();

            for (let key in tags) {
                const keyKlein = key.toLowerCase();
                const valueKlein = String(tags[key]).toLowerCase();

                if (keyKlein.includes(suchwortKlein) || valueKlein.includes(suchwortKlein)) {
                    return true;
                }
            }

            return false;
        }


        let lat;
        let lon;
        let random;
        let random2;
        let daten;
        navigator.geolocation.getCurrentPosition(

        pos => {

            lat = pos.coords.latitude;
            lon = pos.coords.longitude;

            let player = L.circle([lat, lon], {
                    color: 'red',
                    fillColor: '#f03',
                    fillOpacity: 0.5,
                    radius: 10
            }).addTo(map); 
            

            getRegionData(lat, lon).then(data => {
                console.log("Gefundene Objekte:");
                data.elements.forEach((el) => {
                    const tags = el.tags || {};
                    
                });
                daten = data.elements;
                console.log(daten);
                console.log(data);
                console.log(tagsEnthält(daten, "forest"));
            });

      
            setTimeout(() => {
                function weighted_random(items, weights) {
                    let i;
                    for (i = 1; i < weights.length; i++)
                        weights[i] += weights[i - 1];

                    const random = Math.random() * weights[weights.length - 1];
                    for (i = 0; i < weights.length; i++)
                        if (weights[i] > random)
                            break;

                    return items[i];
                }

                for (let i = 0; i < 10; i++) {
                    let random = (Math.random() * 0.006) - 0.003;
                    let random2 = (Math.random() * 0.006) - 0.003;
                    let markerLat = lat + random;
                    let markerLon = lon + random2;

                    let items = ["Gurke", "Goldene Gurke", "Seltene Gurke", "Ungewöhnliche Gurke", "Legendäre Gurke", "Wandergurke", "Essiggurke", "Waldgurke"];
                    let weights = [0.4, 0.07, 0.09, 0.25, 0.04, 0.2, 0.3, 0.5];

                    let aktuelleGurke = weighted_random(items, [...weights]);

                    let marker = L.marker([markerLat, markerLon]).addTo(map).on('click', function(e) {
                        navigator.geolocation.getCurrentPosition(pos => {
                            const lat = pos.coords.latitude;
                            const lon = pos.coords.longitude;
                            const dist = Math.hypot(markerLat - lat, markerLon - lon) * 111000;

                            alert(aktuelleGurke);

                            if (dist < 500) {
                                addPoints(1);
                                map.removeLayer(marker);
                                alert("Gurke");
                            } else {
                                alert("Du bist noch " + Math.round(dist) + " Meter von diesem Ort entfernt");
                            }
                        });
                    });

                    for (let element of daten) {
                        if (tagsEnthält(element.tags, suchwort)) {
                            console.log("Gefunden:", element);
                        }
}
                    }
                }
            }, 20000);



            


        }


        )

        



        

        

    </script>