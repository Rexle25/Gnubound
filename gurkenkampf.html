<!DOCTYPE html>
<head>
    <title>Gurkenflucht</title>

     <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    <link rel="stylesheet" href="style.css">

</head>

<body>

    <div id="map"></div>

    <script>

        var map = L.map('map').setView([46.9480900, 7.4474400], 12);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        function entfernungInMetern(lat1, lon1, lat2, lon2) {
            const R = 6371000;
            const toRad = x => x * Math.PI / 180;

            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);

            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }


        let vorherigeLat;
        let vorherigeLon;
        let playerLat;
        let PlayerLon;
        let player;
        let distToLastSpawn;

        navigator.geolocation.getCurrentPosition( pos => {

            player = L.circle([pos.coords.latitude, pos.coords.longitude], {
                color: 'red',
                fillColor: '#f03',
                fillOpacity: 0.5,
                radius: 10
            }).addTo(map);  

            vorherigeLon = pos.coords.longitude -1;
            vorherigeLat = pos.coords.latitude -1;



        });

        navigator.geolocation.watchPosition( pos => {
            playerLat = pos.coords.latitude;
            playerLon = pos.coords.longitude;

            player.setLatLng([playerLat, playerLon]);

            const dLat = playerLat - vorherigeLat;
            const dLon = playerLon - vorherigeLon;

            distToLastSpawn = entfernungInMetern(vorherigeLat, vorherigeLon, playerLat, playerLon);

            console.log(distToLastSpawn);

            if (distToLastSpawn > 0.001) {
                console.log("Feindliche Gurken werden Gespawnt");
                vorherigeLat = playerLat;
                vorherigeLon = playerLon;
            }

            


        });




    </script>